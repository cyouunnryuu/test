#include "iodefine.h"
#include "vect.h"

#define LED_PORT PORT1.PODR.BIT.B5
#define DELAY_VALUE  50000

#pragma address (VRCR_BYTE=0x00080200)           //VRCR
char VRCR_BYTE;

/*丂娭悢偺僾儘僩僞僀僾愰尵丂*/

void PORT_INITIALIZE(void);
void INTERVAL_DELAY(void);
void change_oscillation_Main_Clock(); 
void Intial_TIMER_MTU0();

int j=0;

/*丂儊僀儞娭悢丂*/
void main(void)
{
	change_oscillation_Main_Clock();					//set mainclock_20MHZ
	PORT_INITIALIZE();        			 		//慡億乕僩弌椡丂慡億乕僩俴俷倂 
	Intial_TIMER_MTU0();
	
	while(1)
	{	if(j>=1000)
		{
			LED_PORT=~LED_PORT;
			j=0;
		}
	 		
	}                    				

}

/*	揰柵娫妘惗惉娭悢	*/
void INTERVAL_DELAY(void)
{
 
	unsigned  long L;
	for ( L = 0 ; L < DELAY_VALUE ; L ++ ); //WAIT
}	


/*丂俬乛俷億乕僩弶婜壔娭悢丂*/
void PORT_INITIALIZE(void)
{
	PORT0.PDR.BYTE = 0xFF;
	PORT1.PDR.BYTE = 0xFF;
	PORT2.PDR.BYTE = 0xFF;
	PORT3.PDR.BYTE = 0x00;//input p36 p37
	PORT4.PDR.BYTE = 0xFF;
	PORT5.PDR.BYTE = 0xFF;
	PORTA.PDR.BYTE = 0xFF;
	PORTB.PDR.BYTE = 0xFF;
	PORTC.PDR.BYTE = 0xFF;
	PORTD.PDR.BYTE = 0xFF;
	PORTE.PDR.BYTE = 0xFF;
	PORTH.PDR.BYTE = 0xFF;
	PORTJ.PDR.BYTE = 0xFF;
	
	PORT0.PODR.BYTE = 0x00;
	PORT1.PODR.BYTE = 0xFF;
	PORT2.PODR.BYTE = 0x00;
	PORT3.PODR.BYTE = 0x00;
	PORT4.PODR.BYTE = 0x00;
	PORT5.PODR.BYTE = 0x00;
	PORTA.PODR.BYTE = 0x00;
	PORTB.PODR.BYTE = 0x00;
	PORTC.PODR.BYTE = 0x00;
	PORTD.PODR.BYTE = 0x00;
	PORTE.PODR.BYTE = 0x00;
	PORTH.PODR.BYTE = 0x00;
	PORTJ.PODR.BYTE = 0x00;
}

void change_oscillation_Main_Clock()
{
    unsigned int  i;
	
	SYSTEM.PRCR.WORD=0xA507;			//Protect 夝彍
	
	VRCR_BYTE=0x00;    					//VRCR幨0
	
	
	SYSTEM.MOSCWTCR.BYTE=0x0F;  		//僋儕僢僋埨掕帪娫愝抲丄20MHZ  50ns*262144>10ms 
		while (0x0F != SYSTEM.MOSCWTCR.BYTE)
   {
        /* Confirm that the written value can be read correctly. */
   }	
	SYSTEM.MOFCR.BYTE=0x30;    	 	//Main Clock Oscillator Drive Capability Switch 20MHZ not lead type ceramic resonator Resonator
	SYSTEM.MOSCCR.BYTE=0x00;       		//Main Clock摦嶌
	while (0x00 != SYSTEM.MOSCCR.BYTE)
   {
        /* Confirm that the written value can be read correctly. */
   }	
	
	for(i=0;i<50000;i++) {}    		    //Wait
    SYSTEM.SCKCR3.WORD=0x0200;        			//Change system clock>>20MHZ
	
	while (0x0200 != SYSTEM.SCKCR3.WORD)
   {
        /* Confirm that the written value can be read correctly. */
   }


	SYSTEM.PRCR.WORD=0xA500;
	
}




void Intial_TIMER_MTU0()
{
	
	SYSTEM.PRCR.WORD=0xA502;			//Protect 夝彍
	SYSTEM.MSTPCRA.BIT.MSTPA9=0;        //MSTPA9儅儖僠僼傽儞僋僔儑儞僞僀儅僷儖僗儐僯僢僩儌僕儏乕儖僗僩僢僾愝掕價僢僩
	MTU0.TCR.BYTE=0x20;					//TGRA偺僐儞儁傾儅僢僠/僀儞僾僢僩僉儍僾僠儍偱TCNT僋儕傾
	MTU0.TGRA=0x4E21;   				//1ms  T=PCLK/(N+1)
	MTU0.TCNT=0x0000;					//MTU0僞僀儅僀僯僔儍儖
	MTU0.TIER.BIT.TGIEA = 1;			//僞僀儅妱傝崬傒敪惗嫋壜
	ICU.IPR[114].BIT.IPR = 2;			//妱傝崬傒儗儀儖愝掕
	ICU.IER[0x0E].BIT.IEN2 = 1;			//妱傝崬傒梫媮嫋壜
	MTU.TSTR.BIT.CST0 = 1;
	while (1!= ICU.IER[0x0E].BIT.IEN2)
   {
        /* Confirm that the written value can be read correctly. */
   }
	SYSTEM.PRCR.WORD=0xA500;
}
